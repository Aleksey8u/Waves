package com.wavesplatform.database

import java.io.{BufferedOutputStream, FileOutputStream}
import java.net.URL

import com.typesafe.scalalogging.StrictLogging
import com.wavesplatform.common.state.ByteStr
import com.wavesplatform.common.utils.EitherExt2
import com.wavesplatform.transaction.{Transaction, TransactionFactory}
import play.api.libs.json.{JsValue, Json}

import scala.collection.mutable
import scala.util.Using

class TXDB(baseDirectory: String) extends StrictLogging {
  private val entries: mutable.AnyRefMap[ByteStr, Transaction] =  {
    val pairs = Json
      .parse("""[
       {"type":3,"id":"47rz7WvhVpfyKjH1zCZHjFtqDUJqqNsqZwuUHfKQArLh","fee":100000000,"feeAssetId":null,"timestamp":1547323763839,"version":2,"sender":"3P3BfzSUq4VHXqTHgbood8A41qnfwDbj4Y9","senderPublicKey":"4C5tD651FrtPUjVDUod1nbhjR7pVc9yomazXaQMr9LxS","proofs":["efohmvFN1MesPCEfXxzGiBP2hXzuuorXS3hHHgbUjw6ixYKe6KfPjSkCU94RRGQYEnzEjCQucRvrkeJssPs6hjy"],"assetId":"47rz7WvhVpfyKjH1zCZHjFtqDUJqqNsqZwuUHfKQArLh","name":"TaxedToken","quantity":1000000000,"reissuable":false,"decimals":8,"description":"This token can be transferred only if you pay tax to the issuer. The tax percentage you can find in the Data Transaction of the issuer (key equals to assetId)","script":"base64:AQQAAAAHJG1hdGNoMAUAAAACdHgDCQAAAQAAAAIFAAAAByRtYXRjaDACAAAAF01hc3NUcmFuc2ZlclRyYW5zYWN0aW9uBAAAAANtdHQFAAAAByRtYXRjaDAEAAAADmZpcnN0UmVjaXBpZW50CAkAAZEAAAACCAUAAAADbXR0AAAACXRyYW5zZmVycwAAAAAAAAAAAAAAAAlyZWNpcGllbnQEAAAAC2ZpcnN0QW1vdW50CAkAAZEAAAACCAUAAAADbXR0AAAACXRyYW5zZmVycwAAAAAAAAAAAAAAAAZhbW91bnQEAAAAB2Fzc2V0SWQJAQAAAAdleHRyYWN0AAAAAQgFAAAAA210dAAAAAdhc3NldElkBAAAABBpc3N1ZVRyYW5zYWN0aW9uCQAD6AAAAAEFAAAAB2Fzc2V0SWQEAAAAByRtYXRjaDEFAAAAEGlzc3VlVHJhbnNhY3Rpb24DCQAAAQAAAAIFAAAAByRtYXRjaDECAAAAEElzc3VlVHJhbnNhY3Rpb24EAAAAB2lzc3VlVHgFAAAAByRtYXRjaDEEAAAADWlzc3VlckFkZHJlc3MJAQAAABRhZGRyZXNzRnJvbVB1YmxpY0tleQAAAAEIBQAAAAdpc3N1ZVR4AAAAD3NlbmRlclB1YmxpY0tleQQAAAAHdGF4U2l6ZQkBAAAAB2V4dHJhY3QAAAABCQAEGgAAAAIFAAAADWlzc3VlckFkZHJlc3MJAAJYAAAAAQUAAAAHYXNzZXRJZAMJAAAAAAAAAgUAAAAOZmlyc3RSZWNpcGllbnQFAAAADWlzc3VlckFkZHJlc3MJAABnAAAAAgUAAAALZmlyc3RBbW91bnQJAABoAAAAAgkAAGkAAAACCAUAAAADbXR0AAAAC3RvdGFsQW1vdW50AAAAAAAAAABkBQAAAAd0YXhTaXplBwcH258+mA==","chainId":87,"height":1348397,"spentComplexity":0},
       {"type":3,"id":"4y2vTR3wKGwxwJEfVRW9RHwijNT7Yka65ByrocPLiJwb","fee":100000000,"feeAssetId":null,"timestamp":1547678345771,"version":2,"sender":"3PKcV9tdDemShtrmiYf56W9FgNtir6VeMz8","senderPublicKey":"DNGVLmhs7v27xRiatre1f66yDQhtmjrsWbXEuRExPSMy","proofs":["wunxWVQEUBk2YYMcReQEtCqEMK9NBMMWyNoQpACY7Tfj4EpCbwoCsMPGATLaLG7DQKZSAAmmPFvcC3dfSgUzexa"],"assetId":"4y2vTR3wKGwxwJEfVRW9RHwijNT7Yka65ByrocPLiJwb","name":"HotPotato","quantity":100000000000,"reissuable":false,"decimals":0,"description":"When you receive this token, you have 100 blocks to transfer it to somebody else, after that 100 blocks you will have to pay the fee more than 1 Waves to transfer it. Technical info: second proof is an id of the incoming transaction.","script":"base64:AQQAAAATbWluaW11bVdhdmVzQmFsYW5jZQAAAAAABfXhAAQAAAAQbW92ZVRpbWVJbkJsb2NrcwAAAAAAAAATiAQAAAAQbWluaW1hbEZlZVRvTW92ZQAAAAAABfXhAAQAAAAQbWluaW1hbEZlZVRvQnVybgAAAAAAHc1lAAQAAAAHJG1hdGNoMAUAAAACdHgDCQAAAQAAAAIFAAAAByRtYXRjaDACAAAAE1RyYW5zZmVyVHJhbnNhY3Rpb24EAAAAAXQFAAAAByRtYXRjaDAEAAAABHR4SWQIBQAAAAF0AAAACmF0dGFjaG1lbnQEAAAAF2N1cnJlbnRSZWNpcGllbnRCYWxhbmNlCQAD6wAAAAIIBQAAAAF0AAAACXJlY2lwaWVudAgFAAAAAXQAAAAHYXNzZXRJZAQAAAAcY3VycmVudFJlY2lwaWVudFdhdmVzQmFsYW5jZQkBAAAADHdhdmVzQmFsYW5jZQAAAAEIBQAAAAF0AAAACXJlY2lwaWVudAQAAAALdHJhbnNhY3Rpb24JAAPoAAAAAQkBAAAAB2V4dHJhY3QAAAABCAUAAAABdAAAAAdhc3NldElkBAAAAAckbWF0Y2gxBQAAAAt0cmFuc2FjdGlvbgMJAAABAAAAAgUAAAAHJG1hdGNoMQIAAAAQSXNzdWVUcmFuc2FjdGlvbgQAAAAHaXNzdWVUeAUAAAAHJG1hdGNoMQQAAAATdHJhbnNhY3Rpb25CeUlzc3VlcgkAAAAAAAACCAUAAAABdAAAAA9zZW5kZXJQdWJsaWNLZXkIBQAAAAdpc3N1ZVR4AAAAD3NlbmRlclB1YmxpY0tleQMFAAAAE3RyYW5zYWN0aW9uQnlJc3N1ZXIDCQAAZgAAAAIFAAAAE21pbmltdW1XYXZlc0JhbGFuY2UFAAAAHGN1cnJlbnRSZWNpcGllbnRXYXZlc0JhbGFuY2UJAAACAAAAAQIAAAAwQ3VycmVudCBiYWxhbmNlIGlzIGxlc3MgdGhhbiBtaW5pbWFsV2F2ZXNCYWxhbmNlBgMJAABmAAAAAgUAAAAXY3VycmVudFJlY2lwaWVudEJhbGFuY2UAAAAAAAAAAAAJAAACAAAAAQIAAAAkUmVjaXBpZW50IGFscmVhZHkgaG9sZHMgYSBob3QgcG90YXRvAwkAAGYAAAACAAAAAAAAAAAgCQAAyAAAAAEIBQAAAAF0AAAACmF0dGFjaG1lbnQJAAACAAAAAQIAAAApQXR0YWNobWVudCBzaG91bGQgY29udGFpbiB0cmFuc2FjdGlvbiBpZCAEAAAACXJlY2VpdmVUeAkAA+gAAAABBQAAAAR0eElkBAAAAAckbWF0Y2gyBQAAAAlyZWNlaXZlVHgDCQAAAQAAAAIFAAAAByRtYXRjaDICAAAAE1RyYW5zZmVyVHJhbnNhY3Rpb24EAAAABXJlY1R4BQAAAAckbWF0Y2gyBAAAABNyZWNlaXZlZEJsb2NrTnVtYmVyCQEAAAAHZXh0cmFjdAAAAAEJAAPpAAAAAQgFAAAABXJlY1R4AAAAAmlkBAAAABpyZWNlaXZlZEFzc2V0SW5MYXN0TkJsb2NrcwMJAABnAAAAAgUAAAAQbW92ZVRpbWVJbkJsb2NrcwkAAGUAAAACBQAAAAZoZWlnaHQFAAAAE3JlY2VpdmVkQmxvY2tOdW1iZXIJAAAAAAAAAggFAAAAAXQAAAAHYXNzZXRJZAgFAAAABXJlY1R4AAAAB2Fzc2V0SWQHBAAAAA1mZWVNb3JlMVdhdmVzCQAAZwAAAAIIBQAAAAF0AAAAA2ZlZQUAAAAQbWluaW1hbEZlZVRvTW92ZQMDCQEAAAABIQAAAAEFAAAAGnJlY2VpdmVkQXNzZXRJbkxhc3ROQmxvY2tzCQEAAAABIQAAAAEFAAAADWZlZU1vcmUxV2F2ZXMHCQAAAgAAAAECAAAAPVlvdSBnb3QgcG90YXRvIGxvbmcgdGltZSBhZ28sIG5vdyB5b3UgaGF2ZSB0byBwYXkgMSBXQVZFUyBmZWUDBQAAABpyZWNlaXZlZEFzc2V0SW5MYXN0TkJsb2NrcwYFAAAADWZlZU1vcmUxV2F2ZXMJAAACAAAAAQIAAAAfUmVjZWl2ZSB0eCBzaG91bGQgYmUgYSB0cmFuc2ZlcgkAAAIAAAABAgAAAAxOb3QgaXNzdWUgdHgDCQAAAQAAAAIFAAAAByRtYXRjaDACAAAAD0J1cm5UcmFuc2FjdGlvbgQAAAAEYnVybgUAAAAHJG1hdGNoMAMJAABmAAAAAgUAAAAQbWluaW1hbEZlZVRvQnVybggFAAAABGJ1cm4AAAADZmVlCQAAAgAAAAECAAAAKllvdSBoYXZlIHRvIHBheSA1IFdBVkVTIHRvIGJ1cm4gdGhpcyB0b2tlbgYDCQAAAQAAAAIFAAAAByRtYXRjaDACAAAAF01hc3NUcmFuc2ZlclRyYW5zYWN0aW9uBAAAAARtYXNzBQAAAAckbWF0Y2gwBAAAAAt0cmFuc2FjdGlvbgkAA+gAAAABCQEAAAAHZXh0cmFjdAAAAAEIBQAAAARtYXNzAAAAB2Fzc2V0SWQEAAAAByRtYXRjaDEFAAAAC3RyYW5zYWN0aW9uAwkAAAEAAAACBQAAAAckbWF0Y2gxAgAAABBJc3N1ZVRyYW5zYWN0aW9uBAAAAAdpc3N1ZVR4BQAAAAckbWF0Y2gxCQAAAAAAAAIIBQAAAARtYXNzAAAAD3NlbmRlclB1YmxpY0tleQgFAAAAB2lzc3VlVHgAAAAPc2VuZGVyUHVibGljS2V5CQAAAgAAAAECAAAAEUJhZCBpc3N1ZSB0eCB0eXBlCQAAAgAAAAECAAAAIFlvdSBvbmx5IGNhbiB0cmFuc2ZlciB0aGlzIHRva2VuCY5Y+w==","chainId":87,"height":1354410,"spentComplexity":0},
       {"type":4,"id":"J6T6sRrXM7LLQaG6QuXjHjneq55gMtqqtUiAvpSqFKSk","fee":100000,"feeAssetId":null,"timestamp":1548097161052,"version":2,"sender":"3PPLV3DUYbxFUmYR4BY19VmKLAGozBdx8z1","senderPublicKey":"CTaQrTooaP6mQGqQ8PusDiGeBGHTf6ycc7E345Cym7pM","proofs":["2W14D3uqVJzDyjMSatHBdov9CiaqSM1iK4Z9H9GGxWLSBmMY99mxFBfJ4x3H2UCvw1gVih4SeULPkkQ7hgV3F6bB"],"recipient":"3PA7q5E3k9bXNn7aWdaK22rEgXr4LKSNWcB","assetId":null,"feeAsset":null,"amount":10500000,"attachment":"","height":1361484,"spentComplexity":0},
       {"type":4,"id":"8nCw1aHg3udYRgtLKsNBaTFRkzZcyQgEqiwFX8YUR9VX","fee":100000,"feeAssetId":null,"timestamp":1548097123174,"version":2,"sender":"3PNEbP2iGdn2bVJJe3deKETeLvymGA2wvMi","senderPublicKey":"CYSNycD47ZeVo455cgMGbFQ5u5NgemE49sF2VQatMGR5","proofs":["5weaFPnpjxj8LpTXf4GFFXeg9t11T8kZzAVJabNb4xJrpeX7ehSwoxtSGU82XJfH8m6MyEs4eY9kQArQYB8AoRJm"],"recipient":"3PA7q5E3k9bXNn7aWdaK22rEgXr4LKSNWcB","assetId":null,"feeAsset":null,"amount":10500000,"attachment":"","height":1361484,"spentComplexity":0},
       {"type":4,"id":"89g6iobd8a8HnS7u4fnjMq22X9M7ZW9SYnsZVxzzAFbk","fee":1000000,"feeAssetId":null,"timestamp":1548173694078,"version":2,"sender":"3PNEbP2iGdn2bVJJe3deKETeLvymGA2wvMi","senderPublicKey":"CYSNycD47ZeVo455cgMGbFQ5u5NgemE49sF2VQatMGR5","proofs":["2e9mo4AGQYJpF5VjFDsNscjxstn7yZWD2VW6Fq8bxz9fqDxQ1YM8NoCuusKRFaMZjpFWL9UN77h9EVNT7JXJYHLJ"],"recipient":"3P3rdiZHei4r24cfYKF3rzCYsJm5bVwwubC","assetId":null,"feeAsset":null,"amount":20000000,"attachment":"","height":1362766,"spentComplexity":0},
       {"type":4,"id":"BvmnD2rBCusVUZKc8nGgALQqqgrDoMfGJHc3bKgfnPA1","fee":10000000,"feeAssetId":null,"timestamp":1548248046538,"version":2,"sender":"3PMsKQfbs1ePb63zkhFC89hFhutdnfzWNtX","senderPublicKey":"H6kXnGKP8Ygv4DUJTAJbVYG56rbtZTUAAeh97WxbF7ou","proofs":["F7WSxbgXEoTScuyUN9XtMysjEUgJpydHpV17jMX9sqRwM2kfJyoecw9DNLg7TKWenRiLpMz8o5bNeGTJUXxXjxA"],"recipient":"3PPUuW2Sz78uh1vjkNU3mc2vsWgFfHfnxTz","assetId":null,"feeAsset":null,"amount":20000000,"attachment":"","height":1364008,"spentComplexity":0},
       {"type":4,"id":"GyXygwdZgwnTkQwJYNTp4kFw6tJtbnf22oJXyXJNipey","fee":10000000,"feeAssetId":null,"timestamp":1548252504128,"version":2,"sender":"3PMsKQfbs1ePb63zkhFC89hFhutdnfzWNtX","senderPublicKey":"H6kXnGKP8Ygv4DUJTAJbVYG56rbtZTUAAeh97WxbF7ou","proofs":["53DfG3in4TBAu4uoG7eTiNFdWStqJzdb3pixtntmKYBKw5GXPhcRTT8tvLJzizzfs9rtiuwFMo95mUhsJJG1KWGV"],"recipient":"3PKXainDFojYdFcATHd7WJLybgi289UjB9y","assetId":null,"feeAsset":null,"amount":20000000,"attachment":"","height":1364083,"spentComplexity":0},
       {"type":4,"id":"7bPkkNoqyEiKf7HUxSqg3bnrs8rtPMVBts2cwGKDMMj5","fee":10000000,"feeAssetId":null,"timestamp":1548258250518,"version":2,"sender":"3P654LjdvBtRoLSUzqPjng2Cd3GdWtUEpcK","senderPublicKey":"3HxE7hWidaRgD5cBqpXaJFRKVRjXhHv52uyNPaSRVEpr","proofs":["3PCJaTaidgmusioFzgHCGYimkWXbdo5kkGMyNp6VoNnjxaQ71GpVY4DQ8x1rNpjrpduE13AkWbDqHJBW5912zLyp"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1364184,"spentComplexity":0},
       {"type":4,"id":"GagLXZ2CGZFfGScAaehKkj4hxQphEsFVE28KcxnGVggZ","fee":10000000,"feeAssetId":null,"timestamp":1548274250773,"version":2,"sender":"3PCUhDui8mZQHFSwjVEGBhxG6rrY2aQNXCB","senderPublicKey":"6iVLPtuQ9JruoCY6PsWN5VXdb5Ede4pdUCt5vPX5mhJG","proofs":["3uoiRW5xaF461Mz5HbQ4E8wDAoSQN9MXrjrdJFwGWGBB4K4S42VmTwUsMpNRKHmk56uvPCn1Pdgg6PfYoiccxrti"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1364457,"spentComplexity":0},
       {"type":4,"id":"7UfryKzMM8wXrJxUr8Fcjzy26MU7oaeD6hvE7ABaSdsf","fee":10000000,"feeAssetId":null,"timestamp":1548275597930,"version":2,"sender":"3PGQ7rY7Bnhkv1y6PGfA7mqhLrMPmBf58r9","senderPublicKey":"F1h5ytQiHJUTspJA6VM71LCKyC2qf6u2qNoccoQUKpxR","proofs":["2GQbZSPbLtuWp7WisMGTkw8Vg59MQoMdALepbr7Vs8Kb4sGZ8NFHajx4nnMVZYiy2Snh77nZpyL1ZMySzboQoRDF"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1364491,"spentComplexity":0},
       {"type":4,"id":"2smSNyX4UXt8UxD4jcfQxqqFkkkCYTBuCE3Bzpud9rqE","fee":10000000,"feeAssetId":null,"timestamp":1548276059083,"version":2,"sender":"3PGQ7rY7Bnhkv1y6PGfA7mqhLrMPmBf58r9","senderPublicKey":"F1h5ytQiHJUTspJA6VM71LCKyC2qf6u2qNoccoQUKpxR","proofs":["5Brg5Nc7m5TphXvxhDP2GcH99boBpJJsFPFW3VmoMngBiH4TAGdf5aufz3s1wjETST6MNfGNEZkRB9PcVpxYSTJK"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1364496,"spentComplexity":0},
       {"type":4,"id":"ACRvXWhdY6iJHEMuPNjgzbzmCey5RimNjLBTfheXnVTN","fee":10000000,"feeAssetId":null,"timestamp":1548309833741,"version":2,"sender":"3PHhtstHEV5gZqqsPiB63wxxY3kzW9N7MwT","senderPublicKey":"2kjLiuMK2YM5tTWQrbRPuhD33kvPMwhMoqtt8gtw6aKb","proofs":["86fDvLqYSFc6d6uihRqNtZuXQk68xX6zhvjKTyuWxjgtJYvaQRJM4JtDV1A724QJD85wYiPFW6bLPjP8ttrudUJ"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1365066,"spentComplexity":0},
       {"type":4,"id":"4pVLgZV2Gtn8T6LZtAKwMmhARhF5269qp8WcgPud1zUK","fee":10000000,"feeAssetId":null,"timestamp":1548316513421,"version":2,"sender":"3PFS92w9tQCze3bbLRt9LDWUQMXEo9Gj59b","senderPublicKey":"Bnp9KXAfZoEZPSPupPv7so4ZScJJ4XkPgQM3VDrNS9dG","proofs":["CR8MwCxhAfKVN2V6qo6tHHk3KTfH7vT3U7pM4Cm6ANMfoRd2L11vuTB37ba8Cmt2s8ZjKbRzkDcTnKsj2anqQ86"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1365184,"spentComplexity":0},
       {"type":4,"id":"HejVDpBp9t4fG3eDDW18yeLMz165mYe3vepNyzCpujip","fee":10000000,"feeAssetId":null,"timestamp":1548383204860,"version":2,"sender":"3PLdec8bgnbYQSL1gcnbDXZenzzszxsScVM","senderPublicKey":"3VxFZaMyCgeAvivgDdVEGhDL2RnDQXemoPfDrUeLTQ2w","proofs":["3Rpzhc5tLzcBDycQHmBhHQJyKeTPtNxictkGVZUdgJNUn7uobhZsartaF2FUWANj9vT2W6mFoDqxPS42jJGndety"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1366293,"spentComplexity":0},
       {"type":4,"id":"HrrjQ9JzYTFw55ANr45WhEB4SmVpVWsos5h8JVVp2egN","fee":10000000,"feeAssetId":null,"timestamp":1548550154633,"version":1,"sender":"3PM1vFT616VVhucSxNpdGnydXHPugYjwgkh","senderPublicKey":"BiNwXiREvNRPw7RBUTCTHRv7wdA5h4zWUtS5VhuNdpwx","proofs":["4dBJiLU83eUvujC4v9Gy6bcqnwMCSM4FeL7qSFQotQXLtnAYNF8cCzmmqipL8mabTPNWf22tckn9RSFKNFXP9FWQ"],"signature":"4dBJiLU83eUvujC4v9Gy6bcqnwMCSM4FeL7qSFQotQXLtnAYNF8cCzmmqipL8mabTPNWf22tckn9RSFKNFXP9FWQ","recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1369102,"spentComplexity":0},
       {"type":4,"id":"CyT1L8WdwWeq4q9h6gTvjp69fpjsyWd7P9ZYV99bjy7A","fee":10000000,"feeAssetId":null,"timestamp":1548682017181,"version":2,"sender":"3PMsKQfbs1ePb63zkhFC89hFhutdnfzWNtX","senderPublicKey":"H6kXnGKP8Ygv4DUJTAJbVYG56rbtZTUAAeh97WxbF7ou","proofs":["23Jfng4k2joXTjqsZZooux3Sqvq7rtuCzwzCor6SYuousTvNmm5NMZLyoCWTpu1k7yi2KRzXHDfoqLkocCSBjjt8"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1371334,"spentComplexity":0},
       {"type":4,"id":"3nKX9qrnKwtteugYFajgcNdZzypgsy13zQ1ZvueFewmx","fee":100000,"feeAssetId":null,"timestamp":1548767190493,"version":2,"sender":"3P4pKfj9UZHqj6pb18921oSftYuQw35gExR","senderPublicKey":"8hgD4WjvwsTMpyiL8qrSRuGHEHgWrzU1KH3sH66sB4px","proofs":["5EGXYoT4tduy2utSnD6VKB5BB723XpXp1iMPBbJRi8hSbSDqo7TcV3tgxf2T4D3n2UwyUKUEQvu8mwJ9WFiigxqW"],"recipient":"3PHmTie5df7ocAEkoMFvVRp74D4hMGhWcYA","assetId":null,"feeAsset":null,"amount":20000000,"attachment":"2JstC8","height":1372762,"spentComplexity":0},
       {"type":4,"id":"6W86NUAzT8ZJrBYAYLS1KUutkFqGte4U68oncePbmbXt","fee":10000000,"feeAssetId":null,"timestamp":1548804255654,"version":1,"sender":"3PM1vFT616VVhucSxNpdGnydXHPugYjwgkh","senderPublicKey":"BiNwXiREvNRPw7RBUTCTHRv7wdA5h4zWUtS5VhuNdpwx","proofs":["4N814GgUKvFdAoJaBsXkUZgCKpmjG2Mx8exJq9DffoAxyECkJPsZb3g9zjj5PKi8u8RHJWgdxqP8ZsYYFFBvLr5q"],"signature":"4N814GgUKvFdAoJaBsXkUZgCKpmjG2Mx8exJq9DffoAxyECkJPsZb3g9zjj5PKi8u8RHJWgdxqP8ZsYYFFBvLr5q","recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1373405,"spentComplexity":0},
       {"type":4,"id":"3WVQ1rUUZo7deQGPinZ4FNGTHyEVc3fZc5po3EF1AZwE","fee":100000,"feeAssetId":null,"timestamp":1548856200776,"version":2,"sender":"3P43d1z1RWjx3P5PVNSPF5Wo6cEURDYqRZc","senderPublicKey":"86QQ4E39fKM4yyve4GDdo4Jw4whvYcveaVkryaQ91VNs","proofs":["5aF2Jf4mmX8c6VnhbzZKrA81BYebAMuymes3DKhrRaHpgg2fsa2dCuR2abgTQgEAYyNWj7oUdVT11WYUaKhLSrY4"],"recipient":"3PFoH8wio9LTJ11zXvAnqtHHLv3xLffCdpR","assetId":null,"feeAsset":null,"amount":100000000,"attachment":"8opYiU7FuUPuGqoLrtzj2ijeMoGgy3qyGFwM7N7irEY","height":1374266,"spentComplexity":0},
       {"type":4,"id":"3PF9SWEQA4AiaS2CQtPmGduJ3mcjC9uTGvkpFxGC1zxQ","fee":100000,"feeAssetId":null,"timestamp":1548878870802,"version":2,"sender":"3PATroLLoxmxWLic7hKHFy7ScVEvfzRWwx9","senderPublicKey":"3JSBy4GBUKkYeQPh6x1xocfevM5PSMRypm6WpBgiFh7c","proofs":["5WP3BjE1eaDTdJsna42WLwygKGqgTnizMgkADoBaYKPoSKCoga3Jge31fAX63V66A6VYv3VZJ4QWCGauCH32R7MR"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"ESo1iG2NGLE","height":1374654,"spentComplexity":0},
       {"type":4,"id":"5xYsu4uBcEGjgvspUBWcwYvvqZtK1fmuBKPPipW7YRuP","fee":100000,"feeAssetId":null,"timestamp":1548923420873,"version":2,"sender":"3P4pKfj9UZHqj6pb18921oSftYuQw35gExR","senderPublicKey":"8hgD4WjvwsTMpyiL8qrSRuGHEHgWrzU1KH3sH66sB4px","proofs":["5Nv1UEvQXBUzyPHqzUjtv76gSdU7fehUMgB3GoNxCi59uZ3JHYQMPRHNo3CsH2orT2ykaozMJwVv67tDoe6vFGA6"],"recipient":"3PFZYMTNXQXUX99zG9q9LW6qnfifXsrujEa","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"2JstC8","height":1375421,"spentComplexity":0},
       {"type":7,"id":"Bq1nbBby3KaJAbPN4q53p1erdDhxiKoVRdc3x6u3QRV9","fee":300000,"feeAssetId":null,"timestamp":1548940680161,"version":2,"sender":"3PJaDyprvekvPXPuAtxrapacuDJopgJRaU3","senderPublicKey":"7kPFrHDiGw1rCm7LPszuECwWYL3dMf6iMifLRDJQZMzy","proofs":["2dch2S69Ln9wwsLperw42cvSm2U14ekqFq3ZiTXzEFkQ7drmeieqsE6WapgciMvX5t2GewGtiEuDT1S7LArjnnCi"],"order1":{"version":1,"id":"2q38VsQQWJrXs28enQJrbyfZfbUyRcAMgqHwnFb8sXj9","sender":"3PGZaNfv59KrciRwWzRx7VsBmKPSuCbb2q9","senderPublicKey":"75LAGRqae58sABeFza8fxSdq5o6zXJWRnCVbVCVjvPu5","matcherPublicKey":"7kPFrHDiGw1rCm7LPszuECwWYL3dMf6iMifLRDJQZMzy","assetPair":{"amountAsset":null,"priceAsset":"Ft8X1v1LTa1ABafufpaCWyVj8KkaxUWE6xBhW6sNFJck"},"orderType":"buy","amount":7650000000,"price":282,"timestamp":1548940678956,"expiration":1548941278956,"matcherFee":300000,"signature":"4iR7c2GLV4Fq9KymshC4juysnHxa7eS2pdG9E7BeobEXphXVUyHo52yVERhtZbSQCuV5DAKqzjUHuLJM1xX4XeLc","proofs":["4iR7c2GLV4Fq9KymshC4juysnHxa7eS2pdG9E7BeobEXphXVUyHo52yVERhtZbSQCuV5DAKqzjUHuLJM1xX4XeLc"]},"order2":{"version":2,"id":"Ff8SjuRjayfqzLiBKuVoKHyYghNJFoXZgFPtw5cPu5yC","sender":"3PKsJG7GAJAhqy79D8xz7RmzvVM3uf2zvXK","senderPublicKey":"84S7Q1LNXkz67pXfJ1W61aNtVrGfZ7v4xdoVTvKFHN3A","matcherPublicKey":"7kPFrHDiGw1rCm7LPszuECwWYL3dMf6iMifLRDJQZMzy","assetPair":{"amountAsset":null,"priceAsset":"Ft8X1v1LTa1ABafufpaCWyVj8KkaxUWE6xBhW6sNFJck"},"orderType":"sell","amount":200000000,"price":282,"timestamp":1548940673211,"expiration":1551446273210,"matcherFee":300000,"signature":"51sUmm27VogyEfg6kKJMkUsuMsRUPpojKmUcYYVrZkmKURrxxEKPNhuCr7rvLrH5H5cmY6uB4nTBDTydm81dpV25","proofs":["51sUmm27VogyEfg6kKJMkUsuMsRUPpojKmUcYYVrZkmKURrxxEKPNhuCr7rvLrH5H5cmY6uB4nTBDTydm81dpV25"]},"amount":200000000,"price":282,"buyMatcherFee":7843,"sellMatcherFee":300000,"height":1375709,"spentComplexity":0},
       {"type":4,"id":"AgCUoiCmCfdZxD6hw7HPyJaKtSxARYQ9cEcHvMmUQ927","fee":10000000,"feeAssetId":null,"timestamp":1548986705107,"version":2,"sender":"3P6Uutv7jLhN7CGwHC7cweED973fwGjE9WQ","senderPublicKey":"5nMy1ZLbRGiTv2id3ExyMUV6aFZ1fn9sfX65sRE21zrd","proofs":["27XuJE8fwzJTNPETYz8RmDtS23MhgWaZYC4LS1RQYVkZPEAh9PF6vDFDbKjwBdXSH7BwiZ1w6sS2GjgDsWr5xhMa"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1376517,"spentComplexity":0},
       {"type":4,"id":"3QFmJ3GSupEjSGYvo31saSj5yHhjdccYGRco6hNmZG7q","fee":100000,"feeAssetId":null,"timestamp":1548882347923,"version":2,"sender":"3PATroLLoxmxWLic7hKHFy7ScVEvfzRWwx9","senderPublicKey":"3JSBy4GBUKkYeQPh6x1xocfevM5PSMRypm6WpBgiFh7c","proofs":["1HVZ4Nj4n3oUTZhwvbRjppWth8cYxxoS43UUikTb7YGaJj4M6Wh1AJaRAFgHwK1iYnRNqSMxBtbjHmjquUwgv6M"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"ESo1iG2NGLE","height":1374717,"spentComplexity":0},
       {"type":4,"id":"GovXZ936iV75nrVQMpJT8MQW5yXYRzm9iPFxxKZFMzrf","fee":100000,"feeAssetId":null,"timestamp":1549360452275,"version":2,"sender":"3P2n61hkvhpFLi4LrUtgArfz1WAgaofo5ki","senderPublicKey":"6VSz5vbEv7TXg9y9tbA47SzYm9JMtZz3KkHa66cTTn8","proofs":["3VyEsjyhieqPbeoaUp3hyZrgtQhi87r4XBxcooBquZwmmCPGmid3zWen9z1Tf1EAmBqU1VSwQF4KjSKD2Dowr4Sh"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1382838,"spentComplexity":0},
       {"type":4,"id":"GjSmwo9GamWqgeM29ybEbeBzRNbKjVVZPYs7iHggmPt8","fee":100000,"feeAssetId":null,"timestamp":1549361003635,"version":2,"sender":"3PP4G9ZaXsRpaKjHTmyHsSH7719eraQyKKz","senderPublicKey":"HHT1wjZQhsJLucV1YPaFkGo7WZfv8mJh9t9VMLcRnPz","proofs":["2XV7xci1TfnTjWwYQgMmymTKMz1HofcZAgrxWt4Jxsrw1yB1T8tpXqwSAJQMLdX5z4A917jxeWT3bYrFcAifyTDa"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1382849,"spentComplexity":0},
       {"type":4,"id":"4aSB5V6dNFjB6pxfFtS3PeYZ5qAmYCPaQZ4KDcyctvt8","fee":100000,"feeAssetId":null,"timestamp":1549375127552,"version":2,"sender":"3P71SdGxi995tjbzmbdt7NWTgwGHFW9rhU5","senderPublicKey":"F1zhwoY2ST51wSxEu7Zc4Fic9SJwQ4eZY8ufTWK78x6y","proofs":["MauB6GaREwFDaRjTkuWp8rB2G5Nu2sVgin3ExJEYghGkRL22gHcN7bQoSc2QLiaJcG6yKy5cDhEdip4VYaq2ujf"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1383091,"spentComplexity":0},
       {"type":4,"id":"S8VF5vPcnvfdP8KPpPF2DLUBJSJDGqDv5xS4Ew3kEXQ","fee":100000,"feeAssetId":null,"timestamp":1549378594094,"version":2,"sender":"3P71SdGxi995tjbzmbdt7NWTgwGHFW9rhU5","senderPublicKey":"F1zhwoY2ST51wSxEu7Zc4Fic9SJwQ4eZY8ufTWK78x6y","proofs":["4G6Vmk6s5uaj4NCv1d8pvHyvbETkXCEHWXPj3GYgux24yBtijwuPcQbdxafFeaKrqtE35baCsXecc211tsFh5HFz"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1383157,"spentComplexity":0},
       {"type":4,"id":"2GjEw9L69c2b9XGqBBULDZWJt2nmRcNQBDMMsfRYdzKW","fee":100000,"feeAssetId":null,"timestamp":1549390987930,"version":2,"sender":"3PP4G9ZaXsRpaKjHTmyHsSH7719eraQyKKz","senderPublicKey":"HHT1wjZQhsJLucV1YPaFkGo7WZfv8mJh9t9VMLcRnPz","proofs":["31N9ApFjG5CzuYaUXu3Jni1UjLy6Q7P8tYJMKbXySQpELurbccHbjYqzncajmr9TEJxc8CKBmyvqVpnrs1wP3Qdr"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1383352,"spentComplexity":0},
       {"type":4,"id":"BBEJHwZfyx1eNn8VuNPEdRVdZxbArW3SAKZRtPsv9KVN","fee":100000,"feeAssetId":null,"timestamp":1549403092432,"version":2,"sender":"3PP4G9ZaXsRpaKjHTmyHsSH7719eraQyKKz","senderPublicKey":"HHT1wjZQhsJLucV1YPaFkGo7WZfv8mJh9t9VMLcRnPz","proofs":["5XDaytxyZsgkW4yTPdceg39kYLtPWhcaKjpGM8tqTcG5A9Uhm6UsTSc4gdupfAp4AkcvDkHaZrp8ojPHjoapxXrJ"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1383550,"spentComplexity":0},
       {"type":4,"id":"z6WdQc1KjwvL14MAag1UnrFSUaKj1G9fHScbpNzM7MM","fee":100000,"feeAssetId":null,"timestamp":1549403139654,"version":2,"sender":"3P4mQ9VnVwZv9y51x7suDRQktzZ7nLhfCbc","senderPublicKey":"DiCauBMsAvUm7zr4zsF8CMUyADBNZegQbQeedP1TVHdS","proofs":["3qXnUG2F8NAUdzyU4FKUA3tyqJFX2fPMPv2ABeYQW2EXkPbWE6Vm3wbmujtwbeMVrn7N2qEQGraP2hywJ1Je6N75"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1383551,"spentComplexity":0},
       {"type":4,"id":"3kGpfVXmhKZWEaBLnftvpzoWX9YSEti261apUTnrS7VR","fee":100000,"feeAssetId":null,"timestamp":1549403893141,"version":2,"sender":"3P8WrXSDDyNC11dm8XANKeDcJricefgTRyZ","senderPublicKey":"APg7QwJSx6naBUPnGYM2vvsJxQcpYabcbzkNJoMUXLai","proofs":["mYKtfqs141BqMP83AUgy3dyN9NUiMxoJ7kiM6RbivRid4fJRw1sd9ETqPAasUUs4cFm3QNc1FtPXRvZwVDKDEvq"],"recipient":"3PJg1FXiq256MyeA5epmzsKAm72pYxfyfsg","assetId":null,"feeAsset":null,"amount":100000000,"attachment":"8opkbSR4XYaZrEuw1aLsnTvwCpfTEkPn4uyNNaKRJQt","height":1383568,"spentComplexity":0},
       {"type":4,"id":"9sXEov46g4yCed63m9TSDjzotKZVK1w581JS8GdRrjgb","fee":100000,"feeAssetId":null,"timestamp":1549406154430,"version":2,"sender":"3P8jvi1RjLcWagYYhaDEx8oNYWrA6SyMc3U","senderPublicKey":"3sZzaE6QfoyxLjeCFvbZqHdtb5E39x2XvxdLJKAWBzKK","proofs":["2H7djcE7m52p4sXs5oDXKMopqTjKjuozJQzEFpjiSajv4CYgzihKXMy1dV42Qu44zQpsQVgR69MVkeShWsVQW8Rc"],"recipient":"3P9QNCmT3Q44zRYXBwKN3azBta9azGqrscm","assetId":null,"feeAsset":null,"amount":110000000,"attachment":"","height":1383610,"spentComplexity":0}
  ]""")
      .as[Seq[JsValue]]
      .map { txJson =>
        val tx = TransactionFactory.fromSignedRequest(txJson).explicitGet()
        tx.id() -> tx
      }
      .toMap
    val builder = mutable.AnyRefMap.newBuilder[ByteStr, Transaction]
    builder ++= pairs
    builder.result()
  }

  private def loadFromPool(id: ByteStr): Transaction = {
    logger.debug(s"Loading $id")
    val url  = new URL(s"https://nodes.wavesnodes.com/transactions/info/${id}")
    val json = Json.parse(url.openStream())
    Using(new FileOutputStream(s"$baseDirectory/${id}.json")) { fos =>
      val bos = new BufferedOutputStream(fos)
        bos.write(Json.toBytes(json))
      bos.flush()
    }
    TransactionFactory.fromSignedRequest(json).explicitGet()
  }

  def load(id: ByteStr): Transaction = entries.getOrElseUpdate(id, loadFromPool(id))
}
